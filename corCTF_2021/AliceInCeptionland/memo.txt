>>> file AliceInCeptionland.exe
AliceInCeptionland.exe: PE32 executable (GUI) Intel 80386 Mono/.Net assembly, for MS Windows

C# decompiler: dnSpy

iv, key를 구해야 하는 것 같다. aes 암호화를 사용하는 것 같다. 
iv, key는 Foo, Bar를 해싱한 값이다. 
Foo, Bar는 image 1, 2에 도달했을 때 cheshirecat.Secret, caterpillar.Secret로 바뀐다. 
cheshirecat의 Secret은 button1_Click 함수에서 특정조건을 만족하면 textBox1.Text로 바뀐다. 조건이 되게 리버싱스럽다. 

str = str.reverse()
text = "41!ce1337"
str[i] ^= text[i % len(text)]
str.reverse() == "oI!&}IusoKs ?Ytr"
// str = [92, 120, 68, 69, 92, 120, 65, 68, 92, 120, 66, 69, 92, 120, 69, 70] = '\\xDE\\xAD\\xBE\\xEF'

str = str.reverse()
text = "c4t3rp1114rz_s3cr3t1y_ru13_7h3_w0r1d"
rol(str[i], 114)
str[i] += 222
str[i] ^= text[i % len(text)]
str[i] -= 127
rol(str[i], 6)
str.reverse() == "\0R\u009c\u007f\u0016ndC\u0005î\u0093MíÃ×\u007f\u0093\u0090\u007fS}­\u0093)ÿÃ\f0\u0093g/\u0003\u0093+Ã¶\0Rt\u007f\u0016\u0087dC\aî\u0093píÃ8\u007f\u0093\u0093\u007fSz­\u0093ÇÿÃÓ0\u0093\u0086/\u0003q"
// str = [92, 120, 52, 92, 120, 76, 92, 120, 49, 92, 120, 67, 92, 120, 51, 92, 120, 49, 92, 120, 83, 92, 120, 78, 92, 120, 48, 92, 120, 84, 92, 120, 52, 92, 120, 83, 92, 120, 76, 92, 120, 51, 92, 120, 51, 92, 120, 80, 92, 120, 83, 92, 120, 52, 92, 120, 86, 92, 120, 51, 92, 120, 72, 92, 120, 51, 92, 120, 82] = '\\x4\\xL\\x1\\xC\\x3\\x1\\xS\\xN\\x0\\xT\\x4\\xS\\xL\\x3\\x3\\xP\\xS\\x4\\xV\\x3\\xH\\x3\\xR'

iv = c591082b809232873d024ed22c2c5252 = 'Å‘+€’2‡=NÒ,,RR'
key = a0405828ddd12f6a0fb868feead857292bbaeb2779e1100774855d365a517ff5 = ' @X(ÝÑ/j¸hþêØW)+ºë'yát…]6ZQõ'
padding: PKCS7

원문을 따로 찾아야하는 것 같다. 
AliceInCeptiondream에서 리소스를 가져온다.

pycryptodomex를 깔고, 블로그 코드를 적당히 가져와서 복호화를 한다. 
복호화를 해도 메모장에서 보이는 것은 없고, hex로 열어본다. 눈에 띄는 것은 딱히 없다. 
파일 시그니쳐를 찾아본다. 특이해보이는 부분문자열은 없고, 다른 파일 형식도 아닌 것 같다. 
비슷한 유니코드가 많이 보인다. flag가 될 수 있는 문자만 남겨도 의미있는 정보는 없다. 
해싱이나 복호화를 잘못해서 잘못나왔던 것 같다. 제대로 복호화하면 exe 파일이 나온다. 


원래 프로그램의 Main의 마지막 부분은 리소스를 decrypt해서 assembly로 만든 후, DeepDream 생성자에 인자로 넘겨서 실행하는 방식이었다. 이 어셈블리는 Dream 변수에 저장된다. 
DeepDream의 button1_Click에서는 Dream의 Encode(textBox1.Text)가 특정 문자열인지 확인한다. 
// dest = "3c3cf1df89fe832aefcc22fc82017cd57bef01df54235e21414122d78a9d88cfef3cf10c829ee32ae4ef01dfa1951cd51b7b22fc82433ef7ef418cdf8a9d802101ef64f9a495268fef18d52882324f217b1bd64b82017cd57bef01df255288f7593922712c958029e7efccdf081f8808a6efd5287595f821482822f6cb95f821cceff4695495268fefe72ad7821a67ae0060ad"

DeepDream의 button2_Click에서는 Dream의 Decrypt(array, textBox1.Text)의 결과를 보여준다. array는 const[]다. 이 결과가 flag인 것 같다. 
// array = [152, 52, 210, 108, 209, 182, 69, 150, 153, 40, 64, 133, 135, 200, 181, 146, 187, 125, 217, 241, 62, 251, 72, 128, 232, 134, 143, 221, 236, 15, 120, 21, 213, 43, 99, 72, 163, 243, 21, 217, 41, 81, 246, 174, 229, 49, 10, 200, 70, 138, 103, 174, 160, 80, 66, 99, 250, 166, 73, 217, 220, 94, 146, 153, 150, 43, 120, 46, 150, 203, 20, 198, 211, 89, 35, 134, 89, 132, 190, 205, 141, 237, 201, 119, 178, 47, 211, 182, 156, 56, 17, 111, 146, 167, 228, 133, 51, 187, 48, 213, 206, 208, 254, 71, 205, 76, 36, 119, 32, 204, 50, 217, 167, 42, 224, 80, 91, 102, 225, 152, 14, 94, 73, 60, 145, 152, 240, 188, 182, 190, 182, 166, 98, 5, 234, 116, 229, 27, 90, 255, 109, 15, 219, 83, 34, 15, 22, 147, 170, 234, 184, 109, 28, 1, 3, 178, 98, 31, 49, 250, 163, 196, 139, 204, 177, 95, 239, 172, 138, 50, 189, 238, 57, 177, 110, 206]

button1 조건을 만족하는 text에 대해, aes_decrypt(ciphertext=array, iv=md5(text), key=sha256(text))를 적용하면 flag를 얻을 수 있다. 


button1 조건:
xm = 1056017893861212352
rm = ['', '', '', '', '\x0f', '\x05\x06\x05\x05\x06', '\x1d\x1d\x1d\x1d\x1d', '\x15\x15\x15\x16\x16', 'nmmnmn', 'ffff', '~}}~', 'uvvu', '\x00', 'FFFF', '^]]^', 'UVVU', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '\x0c\x0f\x0c\x0f\x0c\x0c', '\x04\x07\x04\x04\x07\x04', '\x1f\x1c\x1c\x1c\x1c', '\x14\x14\x14\x14\x17', 'ol', 'gg', '||\x7f|', 'twtt', 'OL', 'GG', '\\\\_\\', 'TWTT', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '\x00', '\x00', '\x1c\x1c\x1f\x1f\x1f', '\x17\x17\x17\x14\x14\x14', 'olll', 'dggg', '|\x7f|', 'wwtt', 'OLLL', 'DGGG', '\\_\\', 'WWTT', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '\x00', '\x05\x06\x05\x06\x05', '\x1d\x1d\x1d\x1e\x1e', '\x16\x15\x16\x15\x16\x15', 'nmnm', 'fef', '}}}', '\x00', 'NMNM', 'FEF', ']]]', '\x00', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '\n\n\n\n\n', '\x01\x01\x02\x02\x01\x01', '\x1a\x1a\x1a\x1a\x19', '\x00', 'ijj', 'babb', 'y', '\x00', 'IJJ', 'BABB', 'Y', '\x00', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '\x00', '\x00\x03\x03\x03\x03\x00', '\x1b\x1b\x1b\x1b\x1b', '\x10\x13\x13\x13\x10', 'k', '``', '{{x', '\x00', 'K', '@@', '[[X', '\x00', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '\x08\x0b\x08\x08\x08', '\x00\x03\x00\x03\x00\x03', '\x1b\x18\x18\x18\x18', '\x00', 'hhkh', 'c`', 'xxx{', '\x00', 'HHKH', 'C@', 'XXX[', '\x00', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '\t\n\n\n\n\t', '\x02\x01\x01\x02\x01', '\x1a\x1a\x19\x19\x19', '\x11\x11\x12\x12\x11\x11', 'jji', 'bbb', 'yzz', 'qqrrqr', 'JJI', 'BBB', 'YZZ', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']
array = [xm & 255, xm >> 8 & 255, xm >> 16 & 255, xm >> 24 & 255, xm >> 32 & 255, xm >> 40 & 255, xm >> 48 & 255, xm >> 56 & 255]


t1 = '/'.join([f(c) for c in plain])
t2 = ''.join([hex(t1[i] ^ array[i % len(array)]) for i in range(len(t))])
if(???)	t2 = t2.reverse()
assert t == dest

뒤에서부터 역으로 실행했을 때, reverse가 실행되면 /가 등장하지 않고, 실행되지 않으면 적절하게 등장한다. 
[f(c) for c in plain] = ['üüü', '$D$$', '\x0c', '\x0c', '»ÛÛ»', '\x0c', 'ù\x99ù', '\x81\x81', "'''", 'Á', 'üüü', '$D$$', '\x0c', '\x0c', '»ÛÛ»', '\x0c', 'ù\x99ù', '\x81\x81', "'''", 'Á', 'i\t\t', '\x81\x81', 'ØØØ', '\x88è', '»ÛÛ»', '»ÛÛ»', '\x0c', '\x88è', 'ù\x99ù', '\x81\x81', "'''", 'Á', '¥¥', '\x06f', 'ØØØ', '_', '\x88è', '\x06f', '_', '\x0c', 'ù\x99ù', '\x81\x81', "'''", '\xa0À\xa0À\xa0\xa0']

f(0~255)를 다 해보면 알 수 있다.


secret = 'Sleeperio Sleeperio Disappeario Instanterio!'
flag = 'corctf{4l1c3_15_1n_d33p_tr0ubl3_b3c4us3_1_d1d_n0t_s4v3_h3r!!:c}'
